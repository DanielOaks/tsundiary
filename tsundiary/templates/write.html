{% extends "base.html" %}

{% block content %}

<div class='post'>
    <div class='post_top'>
      <span class='post_date'>
        Today
      </span>
      <span class="post_controls">
        !!!
      </span>
    </div>
    <hr />
    <div class='post_body'>
      <p>
      <textarea id='edit_area' placeholder="{{ prompt }}" >{{ current_content }}</textarea>
      </p>
    </div>
    <hr />
    <div class='status_area'>
        <span id='char_count'>&nbsp;</span>
        <span id='save_status' style='float:right'><a href='/markdown'>M&darr; enabled</a></span>
    </div>
</div>

{% if old_posts %}
    {% for delta_name, p in old_posts %}
    <div class='post'>
    <div class='post_top'>
      <span class='post_date'>
        {{ p.posted_date | nicedate }}
      </span>
      <span class="post_controls">
        !!!
      </span>
    </div>
    <hr />
    <div class='post_body'>
      {{ p.content | my_markdown | safe }}
    </div>
    </div>
    {% endfor %}
{% else %}
    <p>Once you have a history of old entries, I'll show them to you at certain intervals here...</p>
{% endif %}

<script>
window.last_timestamp = {{ update_time }};
window.textarea = $('#edit_area');
window.old_content = textarea.val();
textarea.bind('input propertychange', content_changed);
if (!window.update_interval) {
  window.update_interval = setInterval(get_updates, 1000);
}

</script>

{% endblock %}
