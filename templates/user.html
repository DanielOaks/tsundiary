{% extends "base.html" %}

{% block content %}

<h1>{{ author.name }}</h1>

{# Dates nav #}
<div style='float:right; text-align: right; width: 60%'>
{% for year, months in dates.items() %}
{{ year }}: 
{% for month in months %}
{% set target = '/~%s/%d/%d' % (author.sid, year, month) %}
{% if request.path == target %}
<a class='selected_date' href='{{ target | safe }}'>{{ month_name[month][:3] }}</a>
{% else %}
<a href='{{ target | safe }}'>{{ month_name[month][:3] }}</a>
{% endif %}
{% endfor %}
<br />
{% endfor %}

{# Other nav #}
{% for link, target in [
('Recent entries', '/~%s' % author.sid),
('All entries ever', '/~%s/all' % author.sid)
] %}
|
{% if request.path == target %}
<a class='selected_date' href='{{ target }}'>{{ link }}</a>
{% else %}
<a href='{{ target }}'>{{ link }}</a>
{% endif %}
{% endfor %}
</div>

{# Stats #}
<span class='stat'>
  <i class="fa fa-edit" title='Number of entries'></i> {{ author.num_entries }} day{% if author.num_entries != 1 %}s{% endif %} of entries
</span><br />
<span class='stat'>
  <i class="fa fa-star" title='Combo'></i> {{ author.combo }} day combo
</span>

{# Header #}
{% block header %}
<h1 style='clear:both'>{{ title }}</h1>
{% endblock %}

{# Posts #}
<div id='posts'>
{% block posts %}
{% for p in posts %}
{{ render_entry(p, hidden_day) | safe }}
{% endfor %}
{% endblock %}
</div>

{# Autoload on scroll -- on main user page only #}
{% if request.path == '/~%s' % author.sid %}
<script>
var processScroll = true;
var last_date = '{{ posts[-1].posted_date }}';
function proc_scroll () {
    if (processScroll && $(window).scrollTop() > $(document).height() - $(window).height() - 400) {
        processScroll = false;
        $.get('/+{{ author.sid }}/' + last_date,
          function (data) {
            new_post = $(data)
            last_date = new_post.data('date');
            if (last_date) {
              $('#posts').append(new_post);
              processScroll = true;
            }
          }
        );
    }
}
$(window).scroll(proc_scroll);
proc_scroll();
</script>
{% endif %}

{% endblock %}
